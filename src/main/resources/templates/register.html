<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	layout:decorate="~{fragments/layout}">
<head>
<meta charset="UTF-8">
<title>Register</title>
<link th:href="@{web/css/register.css}" rel="stylesheet">
<script type="text/javascript" th:src="@{web/js/validator.js}"></script>
</head>
<body>
	<div layout:fragment="content">
		<div class="container">
			<div class="main" style="margin-bottom: 10%;">
				<form class="form" id="form-1">
					<h3 class="heading" style="color: #662d91;">Đăng ký thành viên</h3>
					<th:block th:if="${param.statusError}">
						<p class="desc" style="color: red;">Lỗi hệ thống , vui lòng thử lại sau !</p>
					</th:block>
					<th:block th:unless="${param.statusError}">
						<p class="desc" >Chuyên đồng hồ chính hãng , cao cấp ❤️</p>
					</th:block>

					<div class="spacer"></div>

					<div class="form-group">
						<label for="username" class="form-label">Tên tài khoản</label> <input
							id="username" name="username" type="text"
							placeholder="VD: hongdang99" class="form-control"> <span
							class="form-message" id="messageName" style="color: red;"></span>
					</div>
					<div class="form-group">
						<label for="fullname" class="form-label">Họ tên</label> <input
							id="fullname" name="fullname" type="text"
							placeholder="VD: Nguyễn Hồng Đăng" class="form-control"> <span
							class="form-message" style="color: red;"></span>
					</div>
					<div class="form-group">
						<label for="yearOfBirth" class="form-label">Năm sinh</label> <select
									id="yearOfBirth" name="yearOfBirth" class="form-control">
									<option value="" selected="selected">-- Chọn năm sinh --</option>
									<option value="1951">1951</option>
									<option value="1952">1952</option>
									<option value="1953">1953</option>
									<option value="1954">1954</option>
									<option value="1955">1955</option>
									<option value="1956">1956</option>
									<option value="1957">1957</option>
									<option value="1958">1958</option>
									<option value="1959">1959</option>
									<option value="1960">1960</option>
									<option value="1961">1961</option>
									<option value="1962">1962</option>
									<option value="1963">1963</option>
									<option value="1964">1964</option>
									<option value="1965">1965</option>
									<option value="1966">1966</option>
									<option value="1967">1967</option>
									<option value="1968">1968</option>
									<option value="1969">1969</option>
									<option value="1970">1970</option>
									<option value="1971">1971</option>
									<option value="1972">1972</option>
									<option value="1973">1973</option>
									<option value="1974">1974</option>
									<option value="1975">1975</option>
									<option value="1976">1976</option>
									<option value="1977">1977</option>
									<option value="1978">1978</option>
									<option value="1979">1979</option>
									<option value="1980">1980</option>
									<option value="1981">1981</option>
									<option value="1982">1982</option>
									<option value="1983">1983</option>
									<option value="1984">1984</option>
									<option value="1985">1985</option>
									<option value="1986">1986</option>
									<option value="1987">1987</option>
									<option value="1988">1988</option>
									<option value="1989">1989</option>
									<option value="1990">1990</option>
									<option value="1991">1991</option>
									<option value="1992">1992</option>
									<option value="1993">1993</option>
									<option value="1994">1994</option>
									<option value="1995">1995</option>
									<option value="1996">1996</option>
									<option value="1997">1997</option>
									<option value="1998">1998</option>
									<option value="1999">1999</option>
									<option value="2000">2000</option>
									<option value="2001">2001</option>
									<option value="2002">2002</option>
									<option value="2003">2003</option>
									<option value="2004">2004</option>
									<option value="2005">2005</option>
									<option value="2006">2006</option>
									<option value="2007">2007</option>
									<option value="2008">2008</option>
									<option value="2009">2009</option>
									<option value="2010">2010</option>
								</select> <span
							class="form-message" style="color: red;"></span>
					</div>

					<div class="form-group">
						<label for="email" class="form-label">Email</label> <input
							id="email" name="email" type="text"
							placeholder="VD: email@domain.com" class="form-control">
						<span class="form-message"></span>
					</div>

					<div class="form-group">
						<label for="password" class="form-label">Mật khẩu</label> <input
							id="password" name="password" type="password"
							placeholder="Nhập mật khẩu" class="form-control"> <span
							class="form-message"></span>
					</div>

					<div class="form-group">
						<label for="password_confirmation" class="form-label">Nhập
							lại mật khẩu</label> <input id="password_confirmation"
							placeholder="Nhập lại mật khẩu" type="password"
							class="form-control"> <span class="form-message"></span>
					</div>
					<div class="form-group">
						<div class="row" style="margin-top: 10px;">
							<div class="col-md-3" style="float: left;">
								<input type="radio" name="gender" value="1"> <label
									for="male" style="margin-left: 5px;">Nam</label><br>
							</div>
							<div class="col-md-3">
								<input type="radio" name="gender" value="0"> <label
									for="female" style="margin-left: 5px;">Nữ</label><br>
							</div>
						</div>
					</div>
					<button class="form-submit">Đăng ký</button>
				</form>

				<script type="text/javascript">
					// Validate form 
					Validator({
						form : '#form-1',
						formGroupSelect : '.form-group',
						errorSelector : '.form-message',
						rules : [
								Validator.isRequired('#username',
										'Vui lòng không để trống !'),
										Validator.isRequired('#fullname',
										'Vui lòng không để trống !'),
										Validator.isRequired('#yearOfBirth',
										'Vui lòng không để trống !'),
								Validator.isUsername('#username',
										'Không đúng định dạng !'),
								Validator.isEmail('#email',
										'Phải nhập đúng email !'),
								Validator.isRequired('#password',
										'Vui lòng không để trống !'),
								Validator.minLength('#password', 6,
										'Tối thiểu phải nhập 6 ký tự !'),
								Validator
										.isConfirm(
												'#password_confirmation',
												function() {
													return document
															.querySelector('#form-1 #password').value;
												},
												'Mật khẩu nhập lại không chính xác !'), ],
						onSubmit : function(data) {
							console.log(data);
							$
									.ajax({
										url : '/userMembers',
										type : 'POST',
										contentType : 'application/json',
										data : JSON.stringify(data),
										dataType : 'json',
										success : function(response) {
											alert("Thêm tài khoản thành công");
											window.location.href = "/login?register=true";
										},
										error : function(response) {
										 var data = JSON.parse(response.responseText);
											if (data.status == 400) {
												var element = document.getElementById("messageName")
												element.innerHTML = data.validationErrors.username;
											} else {
												window.location.href = "/register?statusError=true";
											}
										}
									});
						}
					});
				</script>
			</div>
		</div>
	</div>

</body>
</html>





